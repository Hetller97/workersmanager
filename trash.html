<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>سلة المحذوفات</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <button onclick="window.location.href = 'dashboard.html'" style="margin-bottom: 20px;">العودة إلى الصفحة الرئيسية</button>

  <h1>العُمال المحذوفين</h1>
  <table id="trashTable" border="1">
    <thead>
      <tr>
        <th>الاسم</th>
        <th>الكود البنكي</th>
        <th>الرتبة</th>
        <th>الكود</th>
        <th>ملاحظات</th>
        <th>إجراءات</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
  <script>
    // إعداد Firebase (ضع بيانات مشروعك هنا)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    window.onload = fetchTrashedWorkers;

    async function fetchTrashedWorkers() {
      const tableBody = document.querySelector("#trashTable tbody");
      tableBody.innerHTML = "";

      const snapshot = await db.collection("trash").get();
      snapshot.forEach(doc => {
        const data = doc.data();
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${data.name}</td>
          <td>${data.bankCode}</td>
          <td>${data.rank}</td>
          <td>${data.code}</td>
          <td>${data.notes}</td>
          <td>
            <button onclick="restoreWorker('${doc.id}')">استرجاع</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    async function restoreWorker(id) {
      try {
        const docRef = db.collection("trash").doc(id);
        const doc = await docRef.get();

        if (doc.exists) {
          const data = doc.data();
          await db.collection("workers").add(data); // استرجاع العامل
          await docRef.delete(); // حذف من trash
          fetchTrashedWorkers(); // تحديث الجدول
        } else {
          alert("لم يتم العثور على بيانات العامل.");
        }
      } catch (err) {
        console.error("خطأ في الاسترجاع:", err);
      }
    }
  </script>
</body>
</html>
